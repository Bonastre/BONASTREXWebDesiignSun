{% comment %}To be able to have a metafield that is storefront accessible in a custom namespace one needs to use `$app:namespace` and this is the way to access it from liquid, see https://shopify.dev/docs/apps/build/custom-data/reserved-prefixes#create-a-metafield-definition-under-a-reserved-namespace{% endcomment %}

{% liquid
  assign content_blocks_namespace = "app--93504864257--content-blocks"
  assign content_blocks_key = "content_block"
  assign content_blocks = collection.metafields[content_blocks_namespace][content_blocks_key].value

  assign product_duplicate_namespace = "app--93504864257--product-duplicate"
  assign product_duplicate_key = "product_duplicate"
  assign product_duplicate = collection.metafields[product_duplicate_namespace][product_duplicate_key].value

  assign namespace = "app--93504864257--column-settings"
  assign key = "column_settings"
  assign column_settings = shop.metafields[namespace][key].value
  if column_settings[0]
    assign columns_desktop = column_settings[0]
  else
    assign columns_desktop = 4
  endif

  if column_settings[1]
    assign columns_mobile = column_settings[1]
  else
    assign columns_mobile = 2
  endif

  assign ids = ""
  for block in content_blocks
    assign ids = ids | append: block.system.id
    if forloop.last == false
      assign ids = ids | append: ","
    endif
  endfor

  assign page_size = "null"
  if paginate.page_size
    assign page_size = paginate.page_size
  endif
  assign pages = "null"
  if paginate.pages
    assign pages = paginate.pages
  endif
  assign first_page_product_ids = "null"
  assign current_page = "null"
  if paginate.current_page
    comment
      make current_page 0-indexed because that makes it much easier in the typescript side
    endcomment
    assign current_page = paginate.current_page | minus: 1
    if current_page == 0
      assign first_page_product_ids = "["
      for product in collection.products
        assign first_page_product_ids = first_page_product_ids | append: '"gid://shopify/Product/' | append: product.id | append: '"'
        if forloop.last == false
          assign first_page_product_ids = first_page_product_ids | append: ","
        endif
      endfor
      assign first_page_product_ids = first_page_product_ids | append: "]"
    endif
  endif

  assign storefront_key_namespace = "app--93504864257--storefront-access-key"
  assign storefront_key_key = "storefront_access_key"
  assign storefront_access_key = shop.metafields[storefront_key_namespace][storefront_key_key].value
%}

{{ "depict-product-grid.css" | asset_url | stylesheet_tag }}

<script
  id="depict-grid-rendering-script"
  {% if section.settings.align_depict_blocks == "image" %}
    data-align-images="true"
  {% endif %}
  data-columns-mobile="{{ columns_mobile }}"
  data-columns-desktop="{{ columns_desktop }}"
  data-content-blocks="{{ content_blocks | json |  escape }}"
  data-block-ids="{{ ids }}"
  data-duplicates="{{ product_duplicate | json | escape }}"
  data-collection-id="{{ collection.id }}"
  data-storefront-access-key="{{ storefront_access_key }}"
  data-first-page-product-ids="{{ first_page_product_ids | escape }}"
  data-paginate='
    {
    "page_size": {{ page_size }},
    "pages": {{ pages }},
    "current_page": {{ current_page }}
    }
  '
>
  !function(){"use strict";const e={equals:(e,t)=>e===t};let t=k;const n=1,o=2,s={owned:null,cleanups:null,context:null,owner:null};var r=null;let c=null,l=null,a=null,i=null,u=0;function d(t,n){const o={value:t,observers:null,observerSlots:null,comparator:(n=n?Object.assign({},e,n):e).equals||void 0};return[b.bind(o),e=>("function"==typeof e&&(e=e(o.value)),v(o,e))]}function f(e,o,s){t=O;const r=E(e,o,!1,n);r.user=!0,i?i.push(r):w(r)}function p(t,n,o){o=o?Object.assign({},e,o):e;const s=E(t,n,!0,0);return s.observers=null,s.observerSlots=null,s.comparator=o.equals||void 0,w(s),b.bind(s)}function h(e){return y(e,!1)}function g(e){if(null===l)return e();const t=l;l=null;try{return e()}finally{l=t}}function m(e){return null===r||(null===r.cleanups?r.cleanups=[e]:r.cleanups.push(e)),e}function b(){if(this.sources&&this.state)if(this.state===n)w(this);else{const e=a;a=null,y((()=>M(this)),!1),a=e}if(l){const e=this.observers?this.observers.length:0;l.sources?(l.sources.push(this),l.sourceSlots.push(e)):(l.sources=[this],l.sourceSlots=[e]),this.observers?(this.observers.push(l),this.observerSlots.push(l.sources.length-1)):(this.observers=[l],this.observerSlots=[l.sources.length-1])}return this.value}function v(e,t,o){let s=e.value;return e.comparator&&e.comparator(s,t)||(e.value=t,e.observers&&e.observers.length&&y((()=>{for(let t=0;t<e.observers.length;t+=1){const o=e.observers[t],s=c&&c.running;s&&c.disposed.has(o),(s?o.tState:o.state)||(o.pure?a.push(o):i.push(o),o.observers&&P(o)),s||(o.state=n)}if(a.length>1e6)throw a=[],Error()}),!1)),t}function w(e){if(!e.fn)return;T(e);const t=u;((e,t,o)=>{let s;const c=r,a=l;l=r=e;try{s=e.fn(t)}catch(i){return e.pure&&(e.state=n,e.owned&&e.owned.forEach(T),e.owned=null),e.updatedAt=o+1,x(i)}finally{l=a,r=c}(!e.updatedAt||e.updatedAt<=o)&&(null!=e.updatedAt&&"observers"in e?v(e,s):e.value=s,e.updatedAt=o)})(e,e.value,t)}function E(e,t,o,c=n,l){const a={fn:e,state:c,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:r,context:r?r.context:null,pure:o};return null===r||r!==s&&(r.owned?r.owned.push(a):r.owned=[a]),a}function S(e){if(0===e.state)return;if(e.state===o)return M(e);if(e.suspense&&g(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<u);)e.state&&t.push(e);for(let s=t.length-1;s>=0;s--)if((e=t[s]).state===n)w(e);else if(e.state===o){const n=a;a=null,y((()=>M(e,t[0])),!1),a=n}}function y(e,n){if(a)return e();let o=!1;n||(a=[]),i?o=!0:i=[],u++;try{const n=e();return(e=>{if(a&&(k(a),a=null),e)return;const n=i;i=null,n.length&&y((()=>t(n)),!1)})(o),n}catch(s){o||(i=null),a=null,x(s)}}function k(e){for(let t=0;t<e.length;t++)S(e[t])}function O(e){let t,n=0;for(t=0;t<e.length;t++){const o=e[t];o.user?e[n++]=o:S(o)}for(t=0;t<n;t++)S(e[t])}function M(e,t){e.state=0;for(let s=0;s<e.sources.length;s+=1){const r=e.sources[s];if(r.sources){const e=r.state;e===n?r!==t&&(!r.updatedAt||r.updatedAt<u)&&S(r):e===o&&M(r,t)}}}function P(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=o,n.pure?a.push(n):i.push(n),n.observers&&P(n))}}function T(e){let t;if(e.sources)for(;e.sources.length;){const t=e.sources.pop(),n=e.sourceSlots.pop(),o=t.observers;if(o&&o.length){const e=o.pop(),s=t.observerSlots.pop();n<o.length&&(e.sourceSlots[s]=n,o[n]=e,t.observerSlots[n]=s)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)T(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)T(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function x(e,t=r){const n=(e=>e instanceof Error?e:Error("string"==typeof e?e:"Unknown error",{cause:e}))(e);throw n}const C=I("depict-block-media"),B=I("depict-grid-beacon");function I(e){class t extends HTMLElement{static#e=new Set;static#t=new Map;static#n=new Map;static#o=new Set;static onEveryElement(e){const n=o=>{let c=!1,a=()=>c=!0;t.#n.has(n)||t.#n.set(n,[]),t.#n.get(n).push((()=>a())),t.#t.get(o).push((()=>a())),(e=>{const t=l,n=r,o=0===e.length,c=n,a=o?s:{owned:null,cleanups:null,context:c?c.context:null,owner:c},i=o?e:()=>e((()=>g((()=>T(a)))));r=a,l=null;try{return y(i,!0)}finally{l=t,r=n}})((t=>{e(o),c?t():a=t}))};t.#e.add(n),t.#o.forEach(n),m((()=>{t.#e.delete(n),t.#n.get(n).forEach((e=>e())),t.#n.delete(n)}))}connectedCallback(){t.#t.set(this,[()=>{t.#o.delete(this),t.#t.delete(this)}]),t.#o.add(this);for(const e of t.#e)t.#o.has(this)&&e(this)}disconnectedCallback(){t.#t.get(this).forEach((e=>e()))}}return customElements.define(e,t),t}function R(e){const t=[];for(let n=1;n<=e;n++){const o=n/e;t.push(o)}return t.push(0),t}function L({depictBlockMediaElement:e,boundingClientRect:t,elementsToTheLeftOf:n,elementsToTheRightOf:o}){const s=+e.dataset.spanRows,r=+e.dataset.spanColumns,{height:c,width:l}=t,a=c/s,i=l/r,u=c-a+a/2,d=t.top+u,f=innerHeight;if(!(d>=0&&d<=f||t.bottom>=0&&t.bottom<=f))return;const p=new Set(e.parentElement.parentElement.children),h=t.left-i/2,g=t.right+i/2,m=Math.max(d,0),b=e=>p.has(e),v=document.elementsFromPoint(h,m).find(b),w=document.elementsFromPoint(g,m).find(b),[,E]=n.get(e),[,S]=o.get(e);S(w),E(v)}function _(e,t){if(!t)return!1;const n=new URL(t,location.href),o=q(e);return n.pathname.includes(o)}function q(e){return new URL(e,location.href).pathname.split("/").pop().split(".").slice(0,-1).join(".")}function A({maybeProductCardElement:e,existingOffsets:t,setImageOffsetToExtraData:n}){if(e?.matches(".depict-content-block")){const n=e.querySelector("depict-block-media");return()=>t().get(n)?.()}const o=e?.querySelectorAll("img"),s=(t,n)=>{if(!t||!o)return;for(const e of o)if(_(t,e.src)||_(t,e.srcset)||_(t,e.dataset.src))return e;const s=q(t),r=e?.querySelector(`[style*=${JSON.stringify(s)}],${n}`);return r},r="[data-depict-default-image]",c=e?.matches(r)?e:e?.querySelector(r),l=s(c?.dataset?.depictDefaultImage,"[data-depict-default-image-element]"),a=s(c?.dataset?.depictHoverImage,"[data-depict-hover-image-element]");if(!e||!l&&!a)return()=>{};let i=!1;const[u,g]=d(0),[b,v]=d(0),[w,E]=d(0),[S,y]=d(0),k=new ResizeObserver((t=>h((()=>{for(const{target:n,contentRect:{height:o}}of t)n===e?g(o):n===l?v(o):n===a&&E(o),i||(i=!0,queueMicrotask((()=>{const t=(1===e.childElementCount?e.firstElementChild:e).getBoundingClientRect(),n=(w()&&a?a:l).getBoundingClientRect();if(n.width&&n.height&&t.width&&t.height){const e=n.top-t.top;y(e)}else y(0);i=!1})))}))));m((()=>k.disconnect())),l&&k.observe(l),a&&k.observe(a),k.observe(e);const O=p((()=>{const e=u(),t=b()||w();if(e&&t)return e-t}));return f((()=>{const e=S(),t=O();if(null==t)return;const o={topPadding:e,bottomPadding:t-e};n((e=>{let s=e.get(t);return s||(s=new Set,e.set(t,s)),s.add(o),m((()=>n((e=>(s.delete(o),e))))),e}))})),O}const F=new URLSearchParams(location.search).has("depict_debug"),N=new WeakMap;let j=!0;function D(e,t,n){if(!e)return;const o=N.get(e)?.[t];o!==n&&(N.set(e,{...N.get(e),[t]:n}),!F&&j?e?.animate([{[t]:n},{[t]:n}],{fill:"forwards",duration:1}):e?.style.setProperty(t,n))}function J(e){const t=new MessageChannel;t.port1.onmessage=e,t.port2.postMessage("")}j=(()=>{const e=document.createElement("div"),t="--my-variable",n="flex";document.body.append(e),e.setAttribute("style",`display: var(${t});`),D(e,t,n);const o=getComputedStyle(e).display;return e.remove(),o===n})();const z=e=>e instanceof HTMLElement&&!e.matches(".depict-content-block"),$="[data-depict-product-id]";function H(e){for(const t of e)return t}const K="depict_cached_fetch",U=JSON.parse(localStorage[K]||"{}");async function G(e,t,n=!1){const o=JSON.stringify({input:e,init:t}),s=U[o],r=+new Date;if(s&&!n){const e=r-s.time;return{response:new Response(s.value,{status:200}),cacheAgeMs:e}}const c=await fetch(e,t),l=await c.clone().text();return U[o]={time:r,value:l},localStorage[K]=JSON.stringify(U),{response:c,cacheAgeMs:0}}async function V(e,t,n,o=!1){const s=[];let r,c;for(;;){const{response:l,cacheAgeMs:a}=await G("/api/2024-01/graphql.json",W(e,t,r),o),{data:i}=await l.json(),{nodes:u,pageInfo:d}="collection"in i?i.collection.products:i.products;if((null==c||a>c)&&(c=a),r=d.endCursor,s.push(...u.map((e=>e.id))),n(s),!d.hasNextPage)return c}}function W(e,t,n){const o=JSON.stringify(n)||null,s="pageInfo { endCursor hasNextPage hasPreviousPage startCursor }";return{method:"POST",headers:{"Content-Type":"application/json","X-Shopify-Storefront-Access-Token":e},body:JSON.stringify({query:void 0===t?`query Products {\n    products(first: 250, after: ${o}, sortKey: RELEVANCE) {\n        nodes {\n            id\n        }\n        ${s}\n    }\n}`:`query CollectionProducts {\n    collection(id: "gid://shopify/Collection/${t}") {\n        products(first: 250, after: ${o}) {\n            nodes {\n                id\n            }\n            ${s}\n        }\n    }\n}`})}}const X=".depict-grid",Q=document.currentScript,Y="depictGridRenderingRan";if(window[Y])throw console.error(Q,Q.parentElement),Q.remove(),Error("Depict grid rendering ran twice");window[Y]=!0;const[Z,ee]=d(!1),[te,ne]=d("null"),[oe,se]=d("null"),[re,ce]=d("null"),[le,ae]=d("null"),[ie,ue]=d(""),[de,fe]=d(2),[pe,he]=d(),[ge,me]=d(2),[be,ve]=d(),we=()=>h((()=>{const{dataset:e}=Q,t=e.collectionId;he(t?+t:void 0),ee("true"===e.alignImages),ne(e.contentBlocks),ae(e.duplicates),ue(e.blockIds),fe(+e.columnsMobile),me(+e.columnsDesktop),se(e.paginate),ve(e.storefrontAccessKey),ce(e.firstPageProductIds)}));we();const Ee=new MutationObserver(we),Se=(()=>{const e=window.matchMedia("(max-width: 990px)"),[t,n]=d(e.matches),o=e=>n(e.matches);return e.addEventListener("change",o),m((()=>e.removeEventListener("change",o))),t})(),ye=p((()=>Se()?de():ge())),ke=p((()=>JSON.parse(le()))),Oe=p((()=>JSON.parse(oe()))),Me=p((()=>JSON.parse(re()))),Pe=p((()=>{const e=JSON.parse(te()),t=ie().trim().split(",");return e?.map(((e,n)=>({...e,block_id:t[n],span_columns:Math.min(ye(),e.span_columns)})))}));Ee.observe(Q,{attributes:!0}),(({blocksMetaObject:e,duplicates:t,columnsToShow:n,paginate:o,collectionId:s,storefrontApiKey:r,thisScriptTag:c,firstPageProductIdsFromLiquid:l})=>{const{contentBlocks:a,blockMedias:i}=(()=>{const[e,t]=d(new Set,{equals:!1});return C.onEveryElement((e=>{t((t=>t.add(e))),m((()=>t((t=>(t.delete(e),t)))))})),{contentBlocks:p((()=>[...e()].map((e=>e.closest(".depict-content-block"))))),blockMedias:e}})(),u=(e=>{const[t,n]=d(new Set,{equals:!1});return B.onEveryElement((e=>{n((t=>t.add(e))),m((()=>n((t=>(t.delete(e),t)))))})),p((()=>{for(const e of t()){const t=e.previousElementSibling;if(t?.matches(X))return t}for(const t of e()){const e=t.closest(X);if(e)return e}}))})(i),h=((e,t,n)=>{const[o,s]=d(void 0,{equals:!1});return f((async()=>{const n=e();n&&await V(n,t(),s)>6e5&&V(n,t(),s,!0)})),p((()=>{const e=o(),t=n();return!e?.length&&t?.length?t:e}),void 0,{equals:!1})})(r,s,l),{sortedProducts:g,idToLoadedProduct:b}=((e,t)=>{const n=p((()=>{const t=e(),[n,o]=d(new Set);if(!t)return n;o(new Set([...t.children].filter(z)));const s=new MutationObserver((e=>o((t=>{const n=new Set(t);for(const o of e){for(const e of o.addedNodes)z(e)&&n.add(e);for(const e of o.removedNodes)z(e)&&n.delete(e)}return n}))));return s.observe(t,{childList:!0}),m((()=>s.disconnect())),n})),[o,s]=d(!1);let r=!1;const c=p((()=>{const e={};o();for(const t of n()()){const n=t.matches($)?t:t.querySelector($),o=n?.dataset.depictProductId;if(o){const n="gid://shopify/Product/"+o;(e[n]||=[]).push(t)}else r||(J((()=>s((e=>!e)))),r=!0)}return e}));return{sortedProducts:p((()=>{const e=t();if(!e)return[];const n=c();return e.map((e=>n[e])).filter((e=>e))})),idToLoadedProduct:c}})(u,h),[v,w]=d(new Set),{paginatedBlocks:E,takenNonBlockSlots:S}=((e,t,n,o,s,r)=>{const c=p((()=>{const c=t(),l=o(),a=n();if(!l||!a)return;const{page_size:i,current_page:u}=e(),d=new Set(c?.map((e=>e.product))),f=new Map,p=new Set(l),h=s(),g=r(),m=new Map;for(const e of a){const{index:t}=e,n=f.get(t);n?(n.push(e),f.set(t,n)):f.set(t,[e])}const b={},v=new Map;let w=0,E=0,S=0,y=0,k=0;for(let e=0;p.size;){const t=f.get(e),n=v.get(e);if(n)v.delete(e),e+=n;else if(t){f.delete(e);for(const n of t){for(let t=1;t<n.span_rows;t++)v.set(e+g*t,n.span_columns);e+=n.span_columns,(b[E]||=[]).push({...n,relativeIndex:n.index-y})}}else if(w)w--,e++,k++;else{const t=H(p);d.has(t)&&w++,e++,k++,S++,p.delete(t)}const o=Math.floor(S/i);E===o||h.has(o)||(m.set(E,k),k=0,y=e,E=o)}m.set(E,k);for(const[e,t]of f){f.delete(e);for(const e of t)(b[E]||=[]).push({...e,relativeIndex:Math.max(e.index-y,0)})}return{blocksPerPage:b,takenNonBlockSlotsPerPage:m}}));return{paginatedBlocks:p((()=>c()?.blocksPerPage?.[e().current_page])),takenNonBlockSlots:p((()=>c()?.takenNonBlockSlotsPerPage?.get(e().current_page)))}})(o,t,e,h,v,n),y=p((()=>Object.fromEntries(E()?.map((e=>[e.block_id,e]))||[]))),k=((e,t,n)=>p((()=>{let o=t();const s=new Map;if(void 0===o)return s;const r=new Map(e()?.map((e=>[e.relativeIndex,e]))||[]),c=new Map,l=n();let a=0;for(let e=0;e<o;e++){const t=r.get(e),n=c.get(e);if(n)c.delete(e),a+=n;else if(t){const{span_columns:n,span_rows:r,...i}=t;for(let t=1;t<r;t++)c.set(e+l*t,n);o+=n*r,s.set(e-a,t.block_id),a+=n-1}}return s})))(E,S,n),[O,M]=d(new Set),P=((e,t)=>{const[n,o]=d(void 0),s=new ResizeObserver((e=>o(e.at(-1).contentRect.height))),r=p((()=>t()[0]?.[0]));f((()=>{const e=r();e&&(s.observe(e),m((()=>s.unobserve(e))))}));const c=p((()=>{let e=n();return e?e-=10:e=300,e+"px"}));return f((()=>D(e(),"--sample-product-height",c()))),c})(u,g);(e=>{f((()=>{const t={};for(const n of e()){const e=n.dataset.blockId;(t[e]||=[]).push(n)}for(const e in t){const n=t[e];if(n.length>1)for(const e of n.slice(1))e.remove()}}))})(a),((e,t,n,o,s)=>{const r=p((()=>new Set(Object.keys(t())))),c=p((()=>{const e=r(),t=n();if(t)for(let n=0;n<t.length;n++)if(e.has(t[n]))return n})),l=p((()=>r().size));f((()=>{const t=c();if(null==t||void 0===n())return;const{page_size:r,pages:a}=s(),i=Math.floor(t/r),u=new Set;for(let e=t;e<t+l();e+=r){const t=Math.floor(e/r);t!==i&&u.add(t)}const d={pages:a,page_size:r,current_page:i};e.dataset.paginate=JSON.stringify(d,null,2),o(u)}))})(c,b,h,w,o),(({columnsToShow:e,repositionedBlocks:t,blocksById:n,contentBlocks:o,sortedProducts:s,setHiddenBlocks:r,isLastPage:c})=>{f((()=>{const l=new Set(s().flat()),a=Object.fromEntries(o().map((e=>[e.dataset.blockId,e]))),i=t(),u=new Set(Object.keys(a)),d=c(),f=new Map,p=(t,o)=>{const s=a[t],r=n()[t];if(!s||!r)return;const{span_columns:c,span_rows:l}=r,i=c>=e();f.set(o,s),D(s,"--span-columns",c+""),D(s,"--span-rows",(i?1:l)+""),s.classList.add("ordered"),u.delete(t)},h=Array.from({...Object.fromEntries(i),length:Math.max(...i.keys())+1});let g=0;for(;l.size;g++){const e=h[g];if(e){p(e,g);continue}const t=H(l);f.set(g,t),l.delete(t)}for(const e of u){if(d){p(e,g++);continue}const t=a[e];t&&t.classList.remove("ordered")}r(u);const m=f.size;for(const[e,t]of f)D(t,"--order",e-m+"")}))})({columnsToShow:n,repositionedBlocks:k,blocksById:y,contentBlocks:a,sortedProducts:g,setHiddenBlocks:M,isLastPage:p((()=>o().current_page>=o().pages-1))}),(({columnsToShow:e,blockMedias:t,depictGrid:n,blocksById:o,hiddenBlocks:s,sampleProductHeightValue:r})=>{f((()=>{const c=e(),l=[];for(const e of t()){const{spanColumns:t}=e.dataset,n=e.dataset.blockId,r=o()[n];+t<c||!r||s().has(n)?D(e,"--content-aspect-ratio","auto"):(D(e,"--content-aspect-ratio",r.aspect_ratio+""),l[Math.floor(r.relativeIndex/c)]=!0)}const a=[];for(let e=0;e<l.length;e++)l[e]?a.push("auto"):a.push(`minmax(${r()}, auto)`);D(n(),"--grid-template-rows",a.length?a.join(" "):"none")}))})({columnsToShow:n,blockMedias:i,depictGrid:u,blocksById:y,hiddenBlocks:O,sampleProductHeightValue:P}),f((()=>D(u(),"--grid-columns",n()+"")))})({blocksMetaObject:Pe,duplicates:ke,columnsToShow:ye,paginate:Oe,collectionId:pe,storefrontApiKey:be,thisScriptTag:Q,firstPageProductIdsFromLiquid:Me}),f((()=>{Z()&&((()=>{const e=new Map,t=new Map,n=new IntersectionObserver((n=>h((()=>n.forEach((({target:n,boundingClientRect:o})=>L({depictBlockMediaElement:n,boundingClientRect:o,elementsToTheLeftOf:e,elementsToTheRightOf:t})))))),{threshold:R(100)}),[o,s]=d(!1),r=d(new Map,{equals:!1}),c=d(new Map,{equals:!1}),l=new ResizeObserver((()=>{for(const n of e.keys())L({depictBlockMediaElement:n,boundingClientRect:n.getBoundingClientRect(),elementsToTheRightOf:t,elementsToTheLeftOf:e})}));l.observe(document.documentElement),l.observe(document.body);const a=()=>s((e=>!e));addEventListener("DOMContentLoaded",a),addEventListener("load",a),m((()=>{l.disconnect(),removeEventListener("DOMContentLoaded",a),removeEventListener("load",a)})),C.onEveryElement((s=>(({reCheckImagesToggle:e,existingOffsetsSignal:[t,n],element:o,elementsToTheLeftOf:s,elementsToTheRightOf:r,intersectionObserver:c,imageOffsetToExtraDataSignal:[l,a]})=>{const i=d(void 0),u=d(void 0),[h]=i,[g]=u;s.set(o,i),r.set(o,u);const b=p((()=>(e(),A({maybeProductCardElement:h(),setImageOffsetToExtraData:a,existingOffsets:t})))),v=p((()=>(e(),A({maybeProductCardElement:g(),setImageOffsetToExtraData:a,existingOffsets:t})))),w=p((()=>{const e=b()(),t=v()();return Math.min(e??1/0,t??1/0)})),E=p((()=>{const e=l().get(w());return e?e.values().next().value?.topPadding??0:0})),S=p((()=>{const e=l().get(w());if(!e)return 0;const t=e.values().next().value;let n;return n=t?t.bottomPadding:w(),n===1/0?0:n}));f((()=>D(o,"--bottom-alignment-spacing",S()+"px"))),f((()=>D(o,"--top-alignment-spacing",E()+"px"))),n((e=>e.set(o,w))),m((()=>n((e=>(e.delete(o),e))))),c.observe(o),m((()=>{c.unobserve(o),s.delete(o),r.delete(o)}))})({reCheckImagesToggle:o,existingOffsetsSignal:r,element:s,elementsToTheLeftOf:e,elementsToTheRightOf:t,intersectionObserver:n,imageOffsetToExtraDataSignal:c})))})(),te())}))}();

</script>
